<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>REYDM PDF to Image Converter</title>
    
    <script src="js/pdf.min.js"></script>
    <script src="js/jszip.min.js"></script> 
    <style>
        /* All the CSS styles are the same */
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            line-height: 1.6;
            background-color: #000000;
            color: #ffffff;
            max-width: 600px;
            margin: 20px auto;
            padding: 20px;
            border: 1px solid #00d9ff;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }
        h2 {
            text-align: center;
        }
        form {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        .form-group {
            display: flex;
            flex-direction: column;
        }
        label {
            margin-bottom: 5px;
            font-weight: bold;
        }
        input[type="file"], select, input[type="number"] {
            padding: 10px;
            border: 1px solid #0059ff;
            background-color: #000000;
            color: #ffffff;
            border-radius: 4px;
            font-size: 16px;
        }
        button {
            padding: 12px 20px;
            font-size: 16px;
            font-weight: bold;
            color: #fff;
            background-color: #007bff;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            transition: background-color 0.3s;
        }
        button:hover {
            background-color: #0056b3;
        }
        button:disabled {
            background-color: #ccc;
            cursor: not-allowed;
        }
        #status {
            text-align: center;
            font-weight: bold;
            margin-top: 15px;
        }
        /* The preview container is removed */

        /* --- New CSS for the folder upload --- */
        /* From Uiverse.io by 3bdel3ziz-T */ 
        .container {
          --transition: 0;
          --folder-W: 120px;
          --folder-H: 80px;
          display: flex;
          flex-direction: column;
          align-items: center;
          /* MODIFIED PADDING: Removed justify-content/height, added padding-top */
          padding: 140px 10px 10px 10px; 
          background: #000000; 
          border-radius: 15px;
          position: relative;
        }

        .folder {
          position: absolute;
          top: 40px;
          left: calc(50% - 60px);
          animation: float 2.5s infinite ease-in-out;
          transition: transform var(--transition) ease;
        }

        .folder:hover {
          transform: scale(1.05);
        }

        .folder .front-side,
        .folder .back-side {
          position: absolute;
          transition: transform var(--transition);
          transform-origin: bottom center;
        }

        .folder .back-side::before,
        .folder .back-side::after {
          content: "";
          display: block;
          background-color: white;
          opacity: 0.5;
          z-index: 0;
          width: var(--folder-W);
          height: var(--folder-H);
          position: absolute;
          transform-origin: bottom center;
          border-radius: 15px;
          transition: transform 350ms;
          z-index: 0;
        }

        .container:hover .back-side::before {
          transform: rotateX(-5deg) skewX(5deg);
        }
        .container:hover .back-side::after {
          transform: rotateX(-15deg) skewX(12deg);
        }

        .folder .front-side {
          z-index: 1;
        }

        .container:hover .front-side {
          transform: rotateX(-40deg) skewX(15deg);
        }

        .folder .tip {
          background: linear-gradient(135deg, #ff9a56, #ff6f56);
          width: 80px;
          height: 20px;
          border-radius: 12px 12px 0 0;
          box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
          position: absolute;
          top: -10px;
          z-index: 2;
        }

        .folder .cover {
          background: linear-gradient(135deg, #ffe563, #ffc663);
          width: var(--folder-W);
          height: var(--folder-H);
          box-shadow: 0 15px 30px rgba(0, 0, 0, 0.3);
          border-radius: 10px;
        }

        .custom-file-upload {
          font-size: 1.1em;
          color: #ffffff;
          text-align: center;
          background-color: #000000;
          border: 1px solid #0059ff;
          border-radius: 10px;
          cursor: pointer;
          transition: background var(--transition) ease;
          display: inline-block;
          /* MODIFIED: Removed 'width: 100%' to stop full-width flex */
          padding: 10px 35px;
          position: relative;
        }

        .custom-file-upload:hover {
          background: #0059ff;
          color: #000000;
        }

        .custom-file-upload input[type="file"] {
          display: none;
        }

        @keyframes float {
          0% {
            transform: translateY(0px);
          }

          50% {
            transform: translateY(-20px);
          }

          100% {
            transform: translateY(0px);
          }
        }
    </style>
</head>
<body>
    
    <img src="Images/REYDM_LOGO.png" alt="REYDM Logo" style="display: block; margin: 0 auto 20px auto; max-width: 400px;">
    <h2>PDF to Image Converter</h2>
    
    <form id="convert-form">

         
        <div class="container">
          <div class="folder">
            <div class="front-side">
              <div class="tip"></div>
              <div class="cover"></div>
            </div>
            <div class="back-side cover"></div>
          </div>
          <label class="custom-file-upload">
          	<input class="title" id="pdf-file" name="pdf-file" accept=".pdf" required type="file" />
          	1. Choose a PDF File
          </label>
        </div>

        <div class="form-group">
            <label for="format">2. Select Output Format:</label>
            <select id="format" name="format">
                <option value="png">PNG</option>
                <option value="jpeg">JPEG</option>
            </select>
        </div>

        <div class="form-group">
            <label for="dpi">3. Select Quality (DPI):</label>
            <input type="number" id="dpi" name="dpi" value="300" min="72" max="600" step="1">
        </div>

        <button type="submit" id="convert-button">Convert and Download as ZIP</button>
    </form>

    <div id="status"></div>
    <script>
        // Set the worker source to our local 'js' folder
        pdfjsLib.GlobalWorkerOptions.workerSrc = 'js/pdf.worker.min.js';

        // Get all our HTML elements
        const convertForm = document.getElementById('convert-form');
        const pdfFileInput = document.getElementById('pdf-file');
        const formatSelect = document.getElementById('format');
        const dpiInput = document.getElementById('dpi');
        const convertButton = document.getElementById('convert-button');
        const statusMessage = document.getElementById('status');

        // Listen for the form to be submitted
        convertForm.addEventListener('submit', async (e) => {
            e.preventDefault(); 

            const file = pdfFileInput.files[0];
            const fileFormat = formatSelect.value;
            const mimeType = (fileFormat === 'jpeg') ? 'image/jpeg' : 'image/png';
            const dpi = parseInt(dpiInput.value, 10);
            
            if (!file) {
                statusMessage.textContent = 'Error: Please select a PDF file.';
                return;
            }

            convertButton.disabled = true;
            convertButton.textContent = 'Converting...';
            statusMessage.textContent = 'Starting conversion...';

            try {
                // Initialize a new ZIP file
                const zip = new JSZip();
                const baseFilename = file.name.replace(/\.pdf$/i, '');

                const fileData = await readFileAsArrayBuffer(file);
                const pdf = await pdfjsLib.getDocument({ data: fileData }).promise;

                const numPages = pdf.numPages;

                // Create a hidden canvas to draw on
                const canvas = document.createElement('canvas');
                const context = canvas.getContext('2d');

                // --- NEW: Loop through all pages ---
                for (let i = 1; i <= numPages; i++) {
                    statusMessage.textContent = `Rendering Page ${i} of ${numPages}...`;
                    
                    const page = await pdf.getPage(i);
                    const scale = dpi / 96;
                    const viewport = page.getViewport({ scale: scale });

                    // Set canvas size to match the page
                    canvas.height = viewport.height;
                    canvas.width = viewport.rowBytes * viewport.height / viewport.width;

                    // Render the PDF page onto the canvas
                    await page.render({
                        canvasContext: context,
                        viewport: viewport
                    }).promise;

                    // Get the image data from the canvas
                    const imageDataUrl = canvas.toDataURL(mimeType, 1.0);
                    // We need to remove the "data:image/png;base64," prefix
                    const base64Data = imageDataUrl.split(',')[1];
                    
                    // Create the filename for this page
                    const imgFilename = `${baseFilename}_Page_${i}.${fileFormat}`;
                    
                    // Add this image to the ZIP file
                    zip.file(imgFilename, base64Data, { base64: true });
                }
                // --- End of loop ---

                statusMessage.textContent = 'Compressing ZIP file...';

                // Generate the ZIP file as a blob
                const zipBlob = await zip.generateAsync({ type: "blob" });
                
                // Trigger the download for the ZIP file
                const zipFilename = `${baseFilename}.zip`;
                triggerFileDownload(URL.createObjectURL(zipBlob), zipFilename);
                
                statusMessage.textContent = `Success! ${numPages} pages saved to ${zipFilename}.`;

            } catch (error) {
                console.error(error); 
                if (error.name === 'PasswordException') {
                    statusMessage.textContent = 'Error: PDF is password-protected.';
                } else {
                    statusMessage.textContent = `Error: ${error.message}`;
                }
            } finally {
                convertButton.disabled = false;
                convertButton.textContent = 'Convert and Download as ZIP';
            }
        });

        function readFileAsArrayBuffer(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.onload = () => resolve(reader.result);
                reader.onerror = () => reject(reader.error);
                reader.readAsArrayBuffer(file);
            });
        }

        /**
         * Helper function to trigger a file download from a URL
         */
        function triggerFileDownload(dataUrl, filename) {
            const a = document.createElement('a');
            a.href = dataUrl;
            a.download = filename;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            // Revoke the Object URL to free up memory
            URL.revokeObjectURL(dataUrl);
        }

    </script>
</body>
</html>